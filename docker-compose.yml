## docker-compose.yml

version: "3.8"
services:
    dnsdist:
        ## Never deploy more than 1 dnsdist instance per host.
        container_name: dnsdist
        networks:
            dns:
                ipv4_address: 172.16.53.10
        image: docker.io/rootwyrm/dnsdist:latest
        sysctls:
            - net.core.somaxconn=10240
            - net.ipv4.tcp_rmem=10240 87380 12582912
            - net.ipv4.tcp_wmem=10240 87380 12582912
            - net.ipv4.tcp_fin_timeout=15
            - net.ipv4.tcp_tw_reuse=1
            - net.ipv4.tcp_fastopen=3
        restart: on-failure
        tmpfs:
            - /run
            - /tmp
        volumes:
            - "/opt/rootwyrm/etc/dnsdist:/usr/local/etc/dnsdist"
        cap_add:
            - NET_ADMIN
            - NET_BIND_SERVICE
            - SETGID
            - SETUID
    nsd:
        ## If you need more than one nsd, you did it wrong.
        container_name: nsd
        networks:
            dns:
                ipv4_address: 172.16.53.11
        image: docker.io/rootwyrm/nsd:latest
        sysctls:
            - net.core.somaxconn=10240
            - net.ipv4.tcp_rmem=10240 87380 12582912
            - net.ipv4.tcp_wmem=10240 87380 12582912
            - net.ipv4.tcp_fin_timeout=15
            - net.ipv4.tcp_tw_reuse=1
            - net.ipv4.tcp_fastopen=3
        restart: on-failure
        tmpfs:
            - /run
            - /tmp
        volumes:
            - "/opt/rootwyrm/etc/nsd:/usr/local/etc/nsd"
        cap_add:
            - NET_ADMIN
            - NET_BIND_SERVICE
    unbound:
        ## If you need more than one unbound, you did it wrong.
        container_name: unbound
        networks:
            dns:
                ipv4_address: 172.16.53.12
        image: docker.io/rootwyrm/unbound:latest
        sysctls:
            - net.core.somaxconn=10240
            - net.ipv4.tcp_rmem=10240 87380 12582912
            - net.ipv4.tcp_wmem=10240 87380 12582912
            - net.ipv4.tcp_fin_timeout=15
            - net.ipv4.tcp_tw_reuse=1
            - net.ipv4.tcp_fastopen=3
        restart: on-failure
        tmpfs:
            - /run
            - /tmp
        volumes:
            - "/opt/rootwyrm/etc/unbound:/usr/local/etc/unbound"
        cap_add:
            - NET_ADMIN
            - NET_BIND_SERVICE

networks:
    dns:
        ipam:
            config:
                - subnet: "172.16.53.0/24"
